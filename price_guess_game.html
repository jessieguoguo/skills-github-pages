<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>猜猜多少钱？</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'tencent-blue': '#0052D9',
                        'tencent-light-blue': '#4E8BFF',
                        'tencent-green': '#2BA471',
                        'tencent-orange': '#FF9D00',
                        'tencent-red': '#E34D59',
                        'tencent-gray': '#86909C',
                        'tencent-light-gray': '#F2F3F5'
                    },
                    fontFamily: {
                        'microsoft-yahei': ['Microsoft YaHei', 'sans-serif']
                    },
                    boxShadow: {
                        'tencent': '0 2px 8px rgba(0, 0, 0, 0.08)'
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            }
            .btn-shadow {
                box-shadow: 0 2px 0 rgba(0, 0, 0, 0.1);
            }
            .btn-shadow-active {
                box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1);
            }
            .firework {
                position: absolute;
                width: 6px;
                height: 6px;
                background-color: var(--color);
                border-radius: 50%;
                animation: firework-burst 1s ease-out forwards;
            }
            @keyframes firework-burst {
                0% {
                    transform: scale(1);
                    opacity: 1;
                }
                50% {
                    transform: scale(1.5);
                    opacity: 0.8;
                }
                100% {
                    transform: scale(0);
                    opacity: 0;
                }
            }
            .particle {
                position: absolute;
                width: 4px;
                height: 4px;
                background-color: var(--particle-color);
                border-radius: 50%;
                animation: particle-fall 2s ease-in forwards;
            }
            @keyframes particle-fall {
                0% {
                    transform: translateY(0) rotate(0deg);
                    opacity: 1;
                }
                100% {
                    transform: translateY(200px) rotate(360deg);
                    opacity: 0;
                }
            }
            .input-focus {
                box-shadow: 0 0 0 2px rgba(0, 82, 217, 0.2);
            }
            .level-badge {
                background: linear-gradient(135deg, #0052D9 0%, #4E8BFF 100%);
            }
            .progress-bar {
                background: linear-gradient(90deg, #4E8BFF 0%, #0052D9 100%);
            }
        }
    </style>
</head>
<body class="bg-tencent-light-gray font-microsoft-yahei min-h-screen">
    <!-- 游戏主容器 -->
    <div id="game-container" class="container mx-auto px-4 py-6 flex flex-col md:flex-row gap-6 max-w-6xl">
        <!-- 左侧边栏 -->
        <div class="md:w-1/4 space-y-6">
            <!-- 游戏进度 -->
            <div class="bg-white rounded-xl p-5 shadow-tencent">
                <h3 class="text-lg font-bold text-tencent-blue mb-4 flex items-center">
                    <i class="fa fa-trophy mr-2"></i>游戏进度
                </h3>
                <div class="space-y-3">
                    <div>
                        <div class="flex justify-between text-sm mb-1">
                            <span>关卡 1</span>
                            <span id="level1-status" class="text-tencent-gray">未开始</span>
                        </div>
                        <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                            <div id="level1-progress" class="h-full progress-bar rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-sm mb-1">
                            <span>关卡 2</span>
                            <span id="level2-status" class="text-tencent-gray">未解锁</span>
                        </div>
                        <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                            <div id="level2-progress" class="h-full progress-bar rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-sm mb-1">
                            <span>关卡 3</span>
                            <span id="level3-status" class="text-tencent-gray">未解锁</span>
                        </div>
                        <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                            <div id="level3-progress" class="h-full progress-bar rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 当前关卡数据 -->
            <div class="bg-white rounded-xl p-5 shadow-tencent">
                <h3 class="text-lg font-bold text-tencent-blue mb-4 flex items-center">
                    <i class="fa fa-bar-chart mr-2"></i>关卡数据
                </h3>
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-tencent-gray">当前关卡</span>
                        <span id="current-level" class="font-bold text-tencent-blue">1</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-tencent-gray">猜测次数</span>
                        <span id="guess-count" class="font-bold">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-tencent-gray">剩余次数</span>
                        <span id="remaining-guesses" class="font-bold text-tencent-green">14</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-tencent-gray">当前范围</span>
                        <span id="price-range" class="font-bold">1 - 1000</span>
                    </div>
                </div>
            </div>

            <!-- 图片容器 - 使用懒加载和优化尺寸 -->
            <div class="bg-white rounded-xl p-5 shadow-tencent">
                <img src="https://cdn.jsdelivr.net/gh/jessieguoguo/my_image/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202026-01-04%20010243.png" 
                     alt="游戏图片" 
                     class="w-full h-auto rounded-lg" 
                     loading="lazy" 
                     decoding="async">
            </div>
        </div>

        <!-- 右侧游戏区域 -->
        <div class="md:w-3/4">
            <!-- 游戏标题 -->
            <div class="bg-white rounded-xl p-6 shadow-tencent mb-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-tencent-blue text-shadow">猜猜多少钱？</h1>
                        <p class="text-tencent-gray mt-1">第 <span id="display-level">1</span> 关</p>
                    </div>
                    <div class="level-badge text-white text-lg font-bold px-4 py-2 rounded-full">
                        关卡 <span id="level-badge">1</span>
                    </div>
                </div>
            </div>

            <!-- 游戏内容 -->
            <div class="bg-white rounded-xl p-6 shadow-tencent">
                <!-- 提示信息 -->
                <div id="hint-container" class="mb-6">
                    <div id="hint" class="text-center text-lg py-4 bg-tencent-light-gray rounded-lg">
                        请输入你猜测的价格（1-1000之间的整数）
                    </div>
                </div>

                <!-- 输入区域 -->
                <div class="max-w-md mx-auto mb-8">
                    <div class="flex">
                        <input type="number" 
                               id="guess-input" 
                               min="1" 
                               max="1000" 
                               class="flex-1 border border-gray-300 rounded-l-lg px-4 py-3 focus:outline-none focus:input-focus transition-all" 
                               placeholder="请输入价格" 
                               autocomplete="off">
                        <button id="guess-btn" 
                                class="bg-tencent-blue hover:bg-tencent-blue/90 text-white font-bold px-6 py-3 rounded-r-lg transition-all btn-shadow active:btn-shadow-active active:translate-y-0.5">
                            猜价格
                        </button>
                    </div>
                    <div id="input-error" class="text-tencent-red text-sm mt-2 hidden">
                        请输入1-1000之间的整数
                    </div>
                </div>

                <!-- 历史猜测记录 -->
                <div>
                    <h3 class="text-lg font-bold text-tencent-blue mb-3 flex items-center">
                        <i class="fa fa-history mr-2"></i>猜测记录
                    </h3>
                    <div id="guess-history" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2 max-h-40 overflow-y-auto">
                        <!-- 猜测记录将在这里动态生成 -->
                    </div>
                </div>

                <!-- 下一关按钮（默认隐藏） -->
                <div id="next-level-container" class="mt-8 text-center hidden">
                    <button id="next-level-btn" 
                            class="bg-tencent-green hover:bg-tencent-green/90 text-white font-bold px-8 py-3 rounded-lg transition-all btn-shadow active:btn-shadow-active active:translate-y-0.5">
                        下一关
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 结算页面（默认隐藏） -->
    <div id="result-container" class="container mx-auto px-4 py-6 max-w-4xl hidden">
        <div class="bg-white rounded-xl p-8 shadow-tencent">
            <h1 class="text-3xl font-bold text-tencent-blue text-center mb-6">游戏结算</h1>
            
            <div class="space-y-6 mb-8">
                <div class="bg-tencent-light-gray rounded-lg p-4">
                    <h3 class="text-lg font-bold text-tencent-blue mb-3">游戏数据</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span>关卡 1 正确价格：</span>
                            <span id="level1-price" class="font-bold">?</span>
                        </div>
                        <div class="flex justify-between">
                            <span>关卡 1 猜测次数：</span>
                            <span id="level1-guesses" class="font-bold">?</span>
                        </div>
                        <div class="flex justify-between">
                            <span>关卡 2 正确价格：</span>
                            <span id="level2-price" class="font-bold">?</span>
                        </div>
                        <div class="flex justify-between">
                            <span>关卡 2 猜测次数：</span>
                            <span id="level2-guesses" class="font-bold">?</span>
                        </div>
                        <div class="flex justify-between">
                            <span>关卡 3 正确价格：</span>
                            <span id="level3-price" class="font-bold">?</span>
                        </div>
                        <div class="flex justify-between">
                            <span>关卡 3 猜测次数：</span>
                            <span id="level3-guesses" class="font-bold">?</span>
                        </div>
                        <div class="border-t border-gray-200 my-2 pt-2">
                            <div class="flex justify-between">
                                <span class="font-bold">总猜测次数：</span>
                                <span id="total-guesses" class="font-bold text-tencent-blue">?</span>
                            </div>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-bold">最终积分：</span>
                            <span id="total-score" class="font-bold text-tencent-orange">?</span>
                        </div>
                    </div>
                </div>

                <!-- 命名方法 -->
                <div>
                    <h3 class="text-lg font-bold text-tencent-blue mb-3">为你的猜测方法命名</h3>
                    <div class="flex">
                        <input type="text" 
                               id="method-name" 
                               class="flex-1 border border-gray-300 rounded-l-lg px-4 py-3 focus:outline-none focus:input-focus transition-all" 
                        <button id="save-method-btn" 
                                class="bg-tencent-blue hover:bg-tencent-blue/90 text-white font-bold px-6 py-3 rounded-r-lg transition-all btn-shadow active:btn-shadow-active active:translate-y-0.5">
                            保存
                        </button>
                    </div>
                </div>
            </div>

            <!-- 重新开始 -->
            <div class="text-center">
                <button id="restart-btn" 
                        class="bg-tencent-red hover:bg-tencent-red/90 text-white font-bold px-8 py-3 rounded-lg transition-all btn-shadow active:btn-shadow-active active:translate-y-0.5">
                    重新开始游戏
                </button>
            </div>
        </div>
    </div>

    <script>
        // 游戏状态
        const gameState = {
            currentLevel: 1,
            targetPrices: [], // 存储每关的目标价格
            guessCounts: [0, 0, 0], // 存储每关的猜测次数
            completedLevels: [false, false, false], // 存储每关的完成状态
            currentRange: [1, 1000], // 当前猜测范围
            guessHistory: [], // 当前关卡的猜测历史
            usedNumbers: [], // 已使用的数字，用于排除
            maxGuesses: 14 // 每关最大猜测次数
        };

        // DOM 元素
        const gameContainer = document.getElementById('game-container');
        const resultContainer = document.getElementById('result-container');
        const guessInput = document.getElementById('guess-input');
        const guessBtn = document.getElementById('guess-btn');
        const hint = document.getElementById('hint');
        const inputError = document.getElementById('input-error');
        const guessHistory = document.getElementById('guess-history');
        const nextLevelContainer = document.getElementById('next-level-container');
        const nextLevelBtn = document.getElementById('next-level-btn');
        const restartBtn = document.getElementById('restart-btn');
        const methodNameInput = document.getElementById('method-name');
        const saveMethodBtn = document.getElementById('save-method-btn');

        // 状态显示元素
        const currentLevelElement = document.getElementById('current-level');
        const displayLevelElement = document.getElementById('display-level');
        const levelBadgeElement = document.getElementById('level-badge');
        const guessCountElement = document.getElementById('guess-count');
        const remainingGuessesElement = document.getElementById('remaining-guesses');
        const priceRangeElement = document.getElementById('price-range');

        // 关卡状态元素
        const level1Status = document.getElementById('level1-status');
        const level2Status = document.getElementById('level2-status');
        const level3Status = document.getElementById('level3-status');
        const level1Progress = document.getElementById('level1-progress');
        const level2Progress = document.getElementById('level2-progress');
        const level3Progress = document.getElementById('level3-progress');

        // 结算页面元素
        const level1PriceElement = document.getElementById('level1-price');
        const level2PriceElement = document.getElementById('level2-price');
        const level3PriceElement = document.getElementById('level3-price');
        const level1GuessesElement = document.getElementById('level1-guesses');
        const level2GuessesElement = document.getElementById('level2-guesses');
        const level3GuessesElement = document.getElementById('level3-guesses');
        const totalGuessesElement = document.getElementById('total-guesses');
        const totalScoreElement = document.getElementById('total-score');

        // 初始化游戏
        function initGame() {
            generateTargetPrice();
            setupEventListeners();
            updateUI();
        }

        // 生成目标价格（排除二分法前4次可能的猜测）
        function generateTargetPrice() {
            const levelIndex = gameState.currentLevel - 1;
            const excludedNumbers = [];
            
            // 添加二分法前4次可能的猜测
            let low = 1, high = 1000;
            for (let i = 0; i < 4; i++) {
                const mid = Math.floor((low + high) / 2);
                excludedNumbers.push(mid);
                if (i % 2 === 0) {
                    high = mid - 1;
                } else {
                    low = mid + 1;
                }
            }
            
            // 添加之前关卡使用过的数字
            excludedNumbers.push(...gameState.targetPrices);
            
            // 生成随机数字，排除指定的数字
            let randomPrice;
            do {
                randomPrice = Math.floor(Math.random() * 1000) + 1;
            } while (excludedNumbers.includes(randomPrice));
            
            gameState.targetPrices[levelIndex] = randomPrice;
            gameState.currentRange = [1, 1000];
            gameState.guessHistory = [];
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 猜价格按钮点击
            if (guessBtn) {
                guessBtn.addEventListener('click', handleGuess);
            }
            
            // 输入框回车
            if (guessInput) {
                guessInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        handleGuess();
                    }
                });
                
                // 输入框输入时验证
                guessInput.addEventListener('input', validateInput);
            }
            
            // 下一关按钮
            if (nextLevelBtn) {
                nextLevelBtn.addEventListener('click', goToNextLevel);
            }
            
            // 重新开始按钮
            if (restartBtn) {
                restartBtn.addEventListener('click', restartGame);
            }
            
            // 保存方法名称按钮
            if (saveMethodBtn) {
                saveMethodBtn.addEventListener('click', saveMethodName);
            }
        }

        // 验证输入
        function validateInput() {
            const value = parseInt(guessInput.value);
            
            if (isNaN(value) || value < 1 || value > 1000) {
                inputError.classList.remove('hidden');
                return false;
            } else {
                inputError.classList.add('hidden');
                
                // 检查是否在当前范围内
                if (value < gameState.currentRange[0] || value > gameState.currentRange[1]) {
                    hint.textContent = `请输入${gameState.currentRange[0]}-${gameState.currentRange[1]}之间的数字`;
                    hint.className = 'text-center text-lg py-4 bg-red-50 text-tencent-red rounded-lg';
                } else {
                    hint.textContent = `请输入你猜测的价格（${gameState.currentRange[0]}-${gameState.currentRange[1]}之间的整数）`;
                    hint.className = 'text-center text-lg py-4 bg-tencent-light-gray rounded-lg';
                }
                
                return true;
            }
        }

        // 处理猜测
        function handleGuess() {
            if (!validateInput()) return;
            
            const guess = parseInt(guessInput.value);
            const levelIndex = gameState.currentLevel - 1;
            const targetPrice = gameState.targetPrices[levelIndex];
            
            // 增加猜测次数
            gameState.guessCounts[levelIndex]++;
            gameState.guessHistory.push(guess);
            
            // 添加到历史记录
            addGuessToHistory(guess, guess === targetPrice);
            
            // 清空输入框
            guessInput.value = '';
            
            // 检查是否猜对
            if (guess === targetPrice) {
                handleCorrectGuess();
            } else {
                handleIncorrectGuess(guess, targetPrice);
            }
            
            // 更新UI
            updateUI();
            
            // 检查是否超过最大猜测次数
            if (gameState.guessCounts[levelIndex] >= gameState.maxGuesses && !gameState.completedLevels[levelIndex]) {
                handleGameOver();
            }
        }

        // 处理正确猜测
        function handleCorrectGuess() {
            const levelIndex = gameState.currentLevel - 1;
            const targetPrice = gameState.targetPrices[levelIndex];
            
            // 更新游戏状态
            gameState.completedLevels[levelIndex] = true;
            
            // 显示成功提示
            hint.textContent = '恭喜你猜对啦！';
            hint.className = 'text-center text-lg py-4 bg-green-50 text-tencent-green rounded-lg';
            
            // 触发烟花特效
            createFireworks();
            
            // 禁用输入和按钮
            guessInput.disabled = true;
            guessBtn.disabled = true;
            
            // 显示下一关按钮
            if (gameState.currentLevel < 3) {
                nextLevelContainer.classList.remove('hidden');
            } else {
                // 全部关卡完成，显示结算页面
                setTimeout(showResultPage, 2000);
            }
        }

        // 处理错误猜测
        function handleIncorrectGuess(guess, targetPrice) {
            // 更新价格范围
            if (guess < targetPrice) {
                gameState.currentRange[0] = Math.max(gameState.currentRange[0], guess + 1);
                hint.textContent = `猜便宜了！当前价格范围：${gameState.currentRange[0]}-${gameState.currentRange[1]}`;
                hint.className = 'text-center text-lg py-4 bg-blue-50 text-blue-600 rounded-lg';
            } else {
                gameState.currentRange[1] = Math.min(gameState.currentRange[1], guess - 1);
                hint.textContent = `猜贵了！当前价格范围：${gameState.currentRange[0]}-${gameState.currentRange[1]}`;
                hint.className = 'text-center text-lg py-4 bg-orange-50 text-orange-600 rounded-lg';
            }
        }

        // 处理游戏结束（超过猜测次数）
        function handleGameOver() {
            const levelIndex = gameState.currentLevel - 1;
            const targetPrice = gameState.targetPrices[levelIndex];
            
            hint.textContent = `很遗憾，正确价格是${targetPrice}，请重新开始本关`;
            hint.className = 'text-center text-lg py-4 bg-red-50 text-tencent-red rounded-lg';
            
            // 禁用输入和按钮
            guessInput.disabled = true;
            guessBtn.disabled = true;
            
            // 显示重新开始按钮
            nextLevelContainer.classList.remove('hidden');
            nextLevelBtn.textContent = '重新开始本关';
            nextLevelBtn.onclick = restartCurrentLevel;
        }

        // 添加猜测到历史记录
        function addGuessToHistory(guess, isCorrect) {
            const guessElement = document.createElement('div');
            const className = isCorrect 
                ? 'bg-green-100 text-tencent-green' 
                : guess < gameState.targetPrices[gameState.currentLevel - 1] 
                    ? 'bg-blue-100 text-blue-600' 
                    : 'bg-orange-100 text-orange-600';
            
            guessElement.className = `${className} px-3 py-2 rounded-lg text-center font-bold`;
            guessElement.textContent = guess;
            
            // 添加到历史记录容器的开头
            guessHistory.insertBefore(guessElement, guessHistory.firstChild);
        }

        // 创建烟花特效
        function createFireworks() {
            const container = document.body;
            const colors = ['#0052D9', '#4E8BFF', '#2BA471', '#FF9D00', '#E34D59'];
            
            // 创建多个烟花
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    // 随机位置
                    const x = Math.random() * window.innerWidth * 0.8 + window.innerWidth * 0.1;
                    const y = Math.random() * window.innerHeight * 0.6 + window.innerHeight * 0.2;
                    
                    // 创建烟花爆炸效果
                    for (let j = 0; j < 20; j++) {
                        const particle = document.createElement('div');
                        particle.className = 'particle';
                        particle.style.setProperty('--particle-color', colors[Math.floor(Math.random() * colors.length)]);
                        particle.style.left = `${x}px`;
                        particle.style.top = `${y}px`;
                        particle.style.transform = `translate(${(Math.random() - 0.5) * 200}px, ${(Math.random() - 0.5) * 200}px)`;
                        particle.style.animationDelay = `${Math.random() * 0.5}s`;
                        container.appendChild(particle);
                        
                        // 清理
                        setTimeout(() => {
                            particle.remove();
                        }, 2000);
                    }
                }, i * 300);
            }
        }

        // 前往下一关
        function goToNextLevel() {
            // 重置UI
            nextLevelContainer.classList.add('hidden');
            guessHistory.innerHTML = '';
            guessInput.disabled = false;
            guessBtn.disabled = false;
            inputError.classList.add('hidden');
            
            // 增加关卡
            gameState.currentLevel++;
            
            // 生成新的目标价格
            generateTargetPrice();
            
            // 重置提示
            hint.textContent = `请输入你猜测的价格（1-1000之间的整数）`;
            hint.className = 'text-center text-lg py-4 bg-tencent-light-gray rounded-lg';
            
            // 更新UI
            updateUI();
        }

        // 重新开始当前关卡
        function restartCurrentLevel() {
            const levelIndex = gameState.currentLevel - 1;
            
            // 重置当前关卡数据
            gameState.guessCounts[levelIndex] = 0;
            gameState.completedLevels[levelIndex] = false;
            gameState.guessHistory = [];
            
            // 重新生成目标价格
            generateTargetPrice();
            
            // 重置UI
            nextLevelContainer.classList.add('hidden');
            guessHistory.innerHTML = '';
            guessInput.disabled = false;
            guessBtn.disabled = false;
            inputError.classList.add('hidden');
            
            // 重置提示
            hint.textContent = `请输入你猜测的价格（1-1000之间的整数）`;
            hint.className = 'text-center text-lg py-4 bg-tencent-light-gray rounded-lg';
            
            // 更新UI
            updateUI();
        }

        // 重新开始游戏
        function restartGame() {
            // 重置游戏状态
            gameState.currentLevel = 1;
            gameState.targetPrices = [];
            gameState.guessCounts = [0, 0, 0];
            gameState.completedLevels = [false, false, false];
            gameState.currentRange = [1, 1000];
            gameState.guessHistory = [];
            
            // 生成新的目标价格
            generateTargetPrice();
            
            // 重置UI
            nextLevelContainer.classList.add('hidden');
            guessHistory.innerHTML = '';
            guessInput.disabled = false;
            guessBtn.disabled = false;
            inputError.classList.add('hidden');
            
            // 重置提示
            hint.textContent = `请输入你猜测的价格（1-1000之间的整数）`;
            hint.className = 'text-center text-lg py-4 bg-tencent-light-gray rounded-lg';
            
            // 显示游戏容器，隐藏结算页面
            gameContainer.classList.remove('hidden');
            resultContainer.classList.add('hidden');
            
            // 更新UI
            updateUI();
        }

        // 显示结算页面
        function showResultPage() {
            // 隐藏游戏容器，显示结算页面
            gameContainer.classList.add('hidden');
            resultContainer.classList.remove('hidden');
            
            // 填充结算数据
            level1PriceElement.textContent = gameState.targetPrices[0] || '?';
            level2PriceElement.textContent = gameState.targetPrices[1] || '?';
            level3PriceElement.textContent = gameState.targetPrices[2] || '?';
            level1GuessesElement.textContent = gameState.guessCounts[0] || '?';
            level2GuessesElement.textContent = gameState.guessCounts[1] || '?';
            level3GuessesElement.textContent = gameState.guessCounts[2] || '?';
            
            // 计算总猜测次数
            const totalGuesses = gameState.guessCounts.reduce((sum, count) => sum + count, 0);
            totalGuessesElement.textContent = totalGuesses;
            
            // 计算积分（每关基础100分，10次及以下每少1次加10分，10次以上每多1次减10分）
            const calculateScore = (guesses) => {
                if (guesses === 0) return 0;
                const baseScore = 100;
                const scorePerGuess = 10;
                
                if (guesses <= 10) {
                    // 10次及以下，每少一次加10分
                    const bonus = (10 - guesses) * scorePerGuess;
                    return baseScore + bonus;
                } else {
                    // 10次以上，每多一次减10分
                    const penalty = (guesses - 10) * scorePerGuess;
                    return Math.max(0, baseScore - penalty); // 确保分数不低于0
                }
            };
            
            const totalScore = gameState.guessCounts.reduce((sum, count) => sum + calculateScore(count), 0);
            totalScoreElement.textContent = totalScore;
        }

        // 保存方法名称
        function saveMethodName() {
            const methodName = methodNameInput.value.trim();
            if (methodName) {
                alert(`你的猜测方法"${methodName}"已保存！`);
                methodNameInput.value = '';
            } else {
                alert('请输入方法名称');
            }
        }

        // 更新UI
        function updateUI() {
            const levelIndex = gameState.currentLevel - 1;
            
            // 更新当前关卡信息
            currentLevelElement.textContent = gameState.currentLevel;
            displayLevelElement.textContent = gameState.currentLevel;
            levelBadgeElement.textContent = gameState.currentLevel;
            guessCountElement.textContent = gameState.guessCounts[levelIndex];
            remainingGuessesElement.textContent = Math.max(0, gameState.maxGuesses - gameState.guessCounts[levelIndex]);
            priceRangeElement.textContent = `${gameState.currentRange[0]} - ${gameState.currentRange[1]}`;
            
            // 更新关卡状态
            updateLevelStatus(1, gameState.completedLevels[0], gameState.guessCounts[0]);
            updateLevelStatus(2, gameState.completedLevels[1], gameState.guessCounts[1]);
            updateLevelStatus(3, gameState.completedLevels[2], gameState.guessCounts[2]);
        }

        // 更新关卡状态显示
        function updateLevelStatus(level, completed, guesses) {
            const statusElement = document.getElementById(`level${level}-status`);
            const progressElement = document.getElementById(`level${level}-progress`);
            
            if (level < gameState.currentLevel) {
                // 已完成的关卡
                statusElement.textContent = completed ? '已完成' : '未通过';
                statusElement.className = completed ? 'text-tencent-green' : 'text-tencent-red';
                progressElement.style.width = '100%';
            } else if (level === gameState.currentLevel) {
                // 当前关卡
                statusElement.textContent = '进行中';
                statusElement.className = 'text-tencent-blue';
                const progress = Math.min(100, (guesses / gameState.maxGuesses) * 100);
                progressElement.style.width = `${progress}%`;
            } else {
                // 未解锁的关卡
                statusElement.textContent = '未解锁';
                statusElement.className = 'text-tencent-gray';
                progressElement.style.width = '0%';
            }
        }

        // 初始化游戏
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>